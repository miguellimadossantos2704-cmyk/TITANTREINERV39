<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Titan V39 - Gold</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- DESIGN SYSTEM DARK --- */
        :root {
            --bg-app: #09090b;
            --bg-card: #18181b;
            --bg-input: #27272a;
            --primary: #3b82f6;
            --text-main: #fafafa;
            --text-muted: #a1a1aa;
            --border: #3f3f46;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            --radius: 12px;
            --tag-gym-bg: rgba(59, 130, 246, 0.15); --tag-gym-text: #60a5fa;
            --tag-cal-bg: rgba(34, 197, 94, 0.15); --tag-cal-text: #4ade80;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-app);
            color: var(--text-main);
            /* AUMENTEI AQUI DE 110px PARA 160px PARA O BOT√ÉO N√ÉO FICAR ESCONDIDO */
            padding-bottom: 160px;
            height: 100vh;
            overflow-y: auto;
            background-image: radial-gradient(circle at 50% 0%, #1e1b4b 0%, #09090b 60%);
        }

        .hidden { display: none !important; }

        /* --- HEADER & USER --- */
        .header { padding: 24px 20px 16px; background: rgba(9, 9, 11, 0.95); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .user-info h1 { font-size: 1.2rem; font-weight: 700; color: white; margin: 0; }
        .user-info p { font-size: 0.8rem; color: var(--text-muted); margin: 0; }
        .xp-badge { background: rgba(59, 130, 246, 0.15); color: #60a5fa; padding: 4px 12px; border-radius: 20px; font-weight: 700; font-size: 0.75rem; border: 1px solid rgba(59, 130, 246, 0.3); }

        .container { padding: 20px; display: flex; flex-direction: column; gap: 20px; }

        /* --- CARDS --- */
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
        .card-head { padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; background: linear-gradient(to bottom, rgba(255,255,255,0.03), transparent); }
        .card-title { font-weight: 600; font-size: 1rem; color: white; }
        .card-sub { font-size: 0.8rem; color: var(--text-muted); margin-top: 2px; }
        .card-body { padding: 20px; border-top: 1px solid var(--border); display: none; background: rgba(0,0,0,0.2); }
        .card.open .card-body { display: block; }

        /* --- HOME DASHBOARD --- */
        .streak-container { display: flex; justify-content: space-between; margin-top: 15px; }
        .streak-day { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .day-circle { width: 32px; height: 32px; border-radius: 50%; background: var(--bg-input); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: var(--text-muted); }
        .day-circle.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); font-weight: 700; }
        .day-circle.today { border-color: var(--text-main); }

        /* AGUA - 14 Copos */
        .water-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .water-item { height: 45px; background: rgba(14, 165, 233, 0.1); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .water-item.full { background: #0ea5e9; border-color: #0ea5e9; box-shadow: 0 0 10px rgba(14, 165, 233, 0.5); }

        .summary-card { background: linear-gradient(135deg, var(--bg-card) 0%, rgba(59,130,246,0.1) 100%); padding: 20px; border-radius: 16px; border: 1px solid var(--border); display: flex; align-items: center; gap: 20px; }
        .summary-stat { flex: 1; }
        .stat-val { font-size: 1.8rem; font-weight: 800; color: white; }
        .stat-unit { font-size: 0.8rem; color: var(--primary); font-weight: 700; }

        /* --- EXERC√çCIOS (COM HIST√ìRICO) --- */
        .ex-item { display: grid; grid-template-columns: 1fr 60px 60px 40px; gap: 8px; align-items: center; padding: 14px 0; border-bottom: 1px solid var(--border); }
        .ex-meta { display: flex; flex-direction: column; }
        .ex-last { font-size: 0.65rem; color: var(--primary); margin-top: 3px; font-weight: 600; opacity: 0.8; }

        .ex-input-small { background: var(--bg-input); border: 1px solid var(--border); color: white; padding: 8px; border-radius: 6px; text-align: center; font-size: 0.8rem; width: 100%; outline: none; }
        .ex-input-small:focus { border-color: var(--primary); }

        .check-btn { width: 32px; height: 32px; border: 2px solid #52525b; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: transparent; transition: 0.2s; }
        .ex-item.done .check-btn { background: var(--success); border-color: var(--success); color: #09090b; }
        .ex-item.done .ex-name { opacity: 0.4; text-decoration: line-through; }

        .ex-select-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .ex-tag { font-size: 0.6rem; padding: 3px 8px; border-radius: 4px; margin-left: auto; font-weight: 700; }
        .tag-gym { background: var(--tag-gym-bg); color: var(--tag-gym-text); }
        .tag-cal { background: var(--tag-cal-bg); color: var(--tag-cal-text); }

        /* --- GERAL --- */
        .form-input { width: 100%; padding: 14px; background: #27272a; border: 1px solid var(--border); color: white; border-radius: 8px; font-size: 1rem; outline: none; margin-bottom: 15px; }
        .form-input:focus { border-color: var(--primary); }
        .btn-primary { width: 100%; padding: 16px; background: var(--primary); color: white; font-weight: 700; border: none; border-radius: 8px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-outline { width: 100%; padding: 12px; background: transparent; border: 1px solid var(--border); color: var(--text-muted); border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 10px; }

        /* TIMER */
        #smartTimer { position: fixed; bottom: 110px; right: 20px; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); border: 1px solid var(--primary); padding: 12px 20px; border-radius: 50px; display: flex; align-items: center; gap: 12px; box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); z-index: 900; transform: translateX(150%); transition: transform 0.3s; cursor: pointer; }
        #smartTimer.active { transform: translateX(0); }
        .timer-val { font-family: monospace; font-size: 1.1rem; font-weight: 800; color: white; }
        .timer-icon { animation: pulse 1s infinite; }
        @keyframes pulse { 0%{opacity:1} 50%{opacity:0.5} 100%{opacity:1} }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; display: flex; align-items: flex-end; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content { background: var(--bg-card); width: 100%; max-height: 85vh; border-radius: 20px 20px 0 0; padding: 25px; display: flex; flex-direction: column; transform: translateY(100%); transition: 0.3s; border-top: 1px solid var(--border); }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        #customFoodArea { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 15px; }

        /* NAV */
        .nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 90px; background: #09090b; border-top: 1px solid #333; display: flex; justify-content: space-around; align-items: center; z-index: 100; padding-bottom: 15px; }
        .nav-btn { background: none; border: none; color: #a1a1aa; display: flex; flex-direction: column; align-items: center; gap: 6px; cursor: pointer; width: 60px; transition: 0.2s; }
        .nav-btn.active { color: var(--primary); transform: translateY(-2px); }
        .nav-icon { font-size: 1.6rem; } .nav-lbl { font-size: 0.7rem; font-weight: 700; }

        /* LOGIN */
        #loginScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(9, 9, 11, 0.98); z-index: 5000; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .login-card { background: #18181b; width: 100%; max-width: 320px; padding: 50px 30px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); text-align: center; position: relative; }
        .login-avatar { width: 80px; height: 80px; background: #27272a; border-radius: 50%; border: 4px solid var(--bg-app); position: absolute; top: -40px; left: 50%; transform: translateX(-50%); display: flex; align-items: center; justify-content: center; font-size: 2rem; }
    </style>
</head>
<body>

    <div id="smartTimer" onclick="app.addTime()">
        <span class="timer-icon">‚è±Ô∏è</span>
        <span class="timer-val" id="timerDisplay">00:00</span>
        <span style="font-size:0.7rem; font-weight:700; color:var(--primary);">+30s</span>
        <span style="margin-left:12px; color:var(--danger); font-size:1.1rem;" onclick="event.stopPropagation(); app.stopTimer()">‚úï</span>
    </div>

    <div id="loginScreen">
        <div class="login-card">
            <div class="login-avatar">‚ö°</div>
            <h2 style="color:white; margin: 35px 0 25px; font-weight:800; font-size:1.5rem;">TITAN V39</h2>
            <div style="text-align:left; margin-bottom:5px; font-size:0.75rem; color:#a1a1aa; font-weight:700;">NOME</div>
            <input type="text" id="loginUser" class="form-input" placeholder="Seu nome">
            <div style="display: flex; gap: 10px;">
                <div style="flex:1"><div style="text-align:left; margin-bottom:5px; font-size:0.75rem; color:#a1a1aa; font-weight:700;">PESO (KG)</div><input type="number" id="loginWeight" class="form-input" placeholder="00.0"></div>
                <div style="flex:1"><div style="text-align:left; margin-bottom:5px; font-size:0.75rem; color:#a1a1aa; font-weight:700;">ALTURA (CM)</div><input type="number" id="loginHeight" class="form-input" placeholder="000"></div>
            </div>
            <button class="btn-primary" onclick="app.login()">ENTRAR</button>
        </div>
    </div>

    <div id="app" class="hidden">

        <div class="header">
            <div class="user-info"><h1 id="headerName">Usu√°rio</h1><p>Membro Elite</p></div>
            <div class="xp-badge" id="headerXP">0 XP</div>
        </div>

        <div class="container">

            <div id="tab-home">
                <div class="card">
                    <div class="card-head"><div><div class="card-title">Frequ√™ncia</div><div class="card-sub">Semana Atual</div></div></div>
                    <div class="card-body" style="display:block;">
                        <div class="streak-container" id="streakGrid"></div>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-stat">
                        <div class="stat-label">Hoje</div>
                        <div class="stat-val" id="homeKcal">0</div>
                        <div class="stat-unit">Kcal</div>
                    </div>
                    <div style="width:1px; height:40px; background:var(--border);"></div>
                    <div class="summary-stat" style="text-align:right;">
                        <div class="stat-label">Treinos</div>
                        <div class="stat-val" id="homeWorkouts">0</div>
                        <div class="stat-unit">Feitos</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-head"><div><div class="card-title">Hidrata√ß√£o</div><div class="card-sub" id="waterText">0/14 copos</div></div></div>
                    <div class="card-body" style="display:block;">
                        <div class="water-grid" id="waterGrid"></div>
                    </div>
                </div>
                <div style="margin-top:20px; display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <button class="btn-primary" onclick="app.nav('treino', document.getElementById('btn-treino'))">TREINAR</button>
                    <button class="btn-outline" style="margin-top:0; border-color:var(--primary); color:var(--primary);" onclick="app.nav('nutri', document.getElementById('btn-nutri'))">DIETA</button>
                </div>
            </div>

            <div id="tab-treino" class="hidden">
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <button class="btn-primary" style="flex:2;" onclick="app.openModal('workoutModal')">+ NOVA FICHA</button>
                    <button class="btn-outline" style="margin-top:0; flex:1;" onclick="app.openModal('rmModal')">1RM</button>
                    <button class="btn-outline" style="margin-top:0; flex:1;" onclick="app.openModal('imcModal')">IMC</button>
                </div>
                <div id="workoutContainer"></div>
                <div id="emptyMsg" style="text-align:center; padding:40px; color:var(--text-muted); font-size:0.9rem; border: 2px dashed var(--border); border-radius: 12px;">Nenhum treino criado.</div>
            </div>

            <div id="tab-nutri" class="hidden">
                <div class="card">
                    <div class="card-head"><div><div class="card-title">Macronutrientes</div><div class="card-sub">Meta: <span id="targetCal">2000</span></div></div><div class="card-title" id="totalCal" style="font-size:1.5rem;">0</div></div>
                    <div style="padding:20px;">
                        <div style="margin-bottom:10px;"><div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px; color:#a1a1aa;"><span>Prot</span><span id="txtP">0g</span></div><div style="height:6px; background:var(--bg-input); border-radius:3px;"><div id="barP" style="width:0%; height:100%; background:var(--primary); border-radius:3px;"></div></div></div>
                        <div style="margin-bottom:10px;"><div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px; color:#a1a1aa;"><span>Carb</span><span id="txtC">0g</span></div><div style="height:6px; background:var(--bg-input); border-radius:3px;"><div id="barC" style="width:0%; height:100%; background:var(--warning); border-radius:3px;"></div></div></div>
                        <div><div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px; color:#a1a1aa;"><span>Gord</span><span id="txtF">0g</span></div><div style="height:6px; background:var(--bg-input); border-radius:3px;"><div id="barF" style="width:0%; height:100%; background:var(--danger); border-radius:3px;"></div></div></div>
                    </div>
                </div>
                <div style="display:flex; justify-content:space-between; margin:25px 0 10px; align-items:center;">
                    <span style="font-weight:700; color:var(--text-muted); font-size:0.8rem;">DI√ÅRIO</span>
                    <button style="background:transparent; border:1px solid var(--border); color:var(--primary); padding:5px 12px; border-radius:20px; font-size:0.7rem; font-weight:700; cursor:pointer;" onclick="app.openModal('foodModal')">+ ADD</button>
                </div>
                <div id="mealList"></div>
                <button onclick="app.resetDiet()" style="width:100%; margin-top:20px; background:none; border:1px solid var(--border); color:var(--text-muted); padding:10px; border-radius:8px;">Zerar Dia (Dieta)</button>
            </div>

            <div id="tab-config" class="hidden">
                <div class="card">
                    <div class="card-head"><span class="card-title">Dados Corporais</span></div>
                    <div class="card-body" style="display:block;">
                        <div style="display:flex; gap:15px; margin-bottom:15px;">
                            <div style="flex:1"><label style="font-size:0.7rem; color:#888; font-weight:700; display:block; margin-bottom:5px;">PESO</label><input type="number" id="userWeight" class="form-input" style="margin-bottom:0;"></div>
                            <div style="flex:1"><label style="font-size:0.7rem; color:#888; font-weight:700; display:block; margin-bottom:5px;">ALTURA</label><input type="number" id="userHeight" class="form-input" style="margin-bottom:0;"></div>
                        </div>
                        <label style="font-size:0.7rem; color:#888; font-weight:700; display:block; margin-bottom:5px;">IDADE</label><input type="number" id="userAge" class="form-input">
                        <label style="font-size:0.7rem; color:#888; font-weight:700; display:block; margin-bottom:5px;">SEXO</label><select id="userSex" class="form-input"><option value="m">Masculino</option><option value="f">Feminino</option></select>
                        <button class="btn-primary" onclick="app.saveProfile()">Salvar & Recalcular</button>
                    </div>
                </div>

                <div class="card" style="margin-top:20px;">
                    <div class="card-head"><span class="card-title">Ferramentas</span></div>
                    <div class="card-body" style="display:block;">
                        <button class="btn-outline" style="border-color:var(--primary); color:var(--primary);" onclick="app.openModal('measurementsModal')">üìè MINHAS MEDIDAS</button>
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            <button class="btn-primary" style="flex:1; font-size:0.8rem; background:#27272a; border:1px solid var(--border);" onclick="app.exportData()">EXPORTAR DADOS</button>
                            <button class="btn-outline" style="flex:1; margin-top:0; font-size:0.8rem;" onclick="app.importData()">IMPORTAR</button>
                        </div>
                    </div>
                </div>

                <button class="btn-outline" onclick="app.resetAll()" style="color:var(--danger); border-color:var(--danger); margin-top:25px;">RESETAR APP</button>
                <button class="btn-outline" onclick="app.logout()">SAIR</button>
            </div>
        </div>

        <div class="nav">
            <button class="nav-btn active" onclick="app.nav('home', this)" id="btn-home"><span class="nav-icon">üè†</span><span class="nav-lbl">IN√çCIO</span></button>
            <button class="nav-btn" onclick="app.nav('treino', this)" id="btn-treino"><span class="nav-icon">üèãÔ∏è</span><span class="nav-lbl">TREINO</span></button>
            <button class="nav-btn" onclick="app.nav('nutri', this)" id="btn-nutri"><span class="nav-icon">üçé</span><span class="nav-lbl">DIETA</span></button>
            <button class="nav-btn" onclick="app.nav('config', this)"><span class="nav-icon">‚öôÔ∏è</span><span class="nav-lbl">PERFIL</span></button>
        </div>
    </div>

    <div id="workoutModal" class="modal-overlay"><div class="modal-content">
        <h3 style="color:white; margin-bottom:20px;">Criar Ficha</h3>
        <input type="text" id="workoutName" class="form-input" placeholder="Nome (Ex: Peito A)">
        <select id="muscleGroup" class="form-input" onchange="app.renderExList()">
            <option value="" disabled selected>Selecionar Grupo</option><option value="PEITO">Peito</option><option value="COSTAS">Costas</option><option value="OMBROS">Ombros</option><option value="B√çCEPS">B√≠ceps</option><option value="TR√çCEPS">Tr√≠ceps</option><option value="QUADRICEPS">Quadr√≠ceps</option><option value="POSTERIOR">Posterior</option><option value="GLUTEOS">Gl√∫teos</option><option value="PANTURRILHA">Panturrilhas</option><option value="CORE">Abd√¥men</option><option value="ANTEBRACO">Antebra√ßo</option><option value="FUNCIONAL">Funcional</option><option value="SKILLS">Skills</option>
        </select>
        <div id="exListArea" style="flex:1; overflow-y:auto; border:1px solid var(--border); margin-bottom:15px; padding:10px; background:var(--bg-input); border-radius:8px;"></div>
        <button class="btn-primary" onclick="app.saveWorkout()">Salvar</button>
        <button class="btn-outline" onclick="app.closeModals()">Cancelar</button>
    </div></div>

    <div id="rmModal" class="modal-overlay"><div class="modal-content" style="text-align:center;"><h3 style="color:white; margin-bottom:20px;">Calculadora 1RM</h3><input type="number" id="rmWeight" class="form-input" placeholder="Peso usado (kg)"><input type="number" id="rmReps" class="form-input" placeholder="Repeti√ß√µes feitas"><button class="btn-primary" onclick="app.calcRM()">CALCULAR</button><div id="rmResult" style="margin-top:20px; font-size:1.5rem; color:var(--primary); font-weight:800;"></div><button class="btn-outline" onclick="app.closeModals()">Fechar</button></div></div>

    <div id="imcModal" class="modal-overlay"><div class="modal-content" style="text-align:center;">
        <h3 style="color:white; margin-bottom:20px;">Calculadora IMC</h3>
        <input type="number" id="imcWeight" class="form-input" placeholder="Peso (kg)">
        <input type="number" id="imcHeight" class="form-input" placeholder="Altura (cm)">
        <button class="btn-primary" onclick="app.calcIMC()">CALCULAR</button>
        <div id="imcResult" style="margin-top:20px;">
            <div style="font-size:2.5rem; font-weight:800; color:var(--primary);" id="imcValue">--</div>
            <div style="font-size:1rem; color:var(--text-muted); font-weight:700;" id="imcText">Preencha os dados</div>
        </div>
        <button class="btn-outline" onclick="app.closeModals()">Fechar</button>
    </div></div>

    <div id="foodModal" class="modal-overlay"><div class="modal-content" style="height:auto;">
        <h3 style="color:white; margin-bottom:20px;">Adicionar Alimento</h3>
        <select id="foodSelect" class="form-input" onchange="app.checkCustomFood()"></select>
        <div id="customFoodArea" class="hidden" style="background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; margin-bottom:15px;">
            <input type="text" id="customName" class="form-input" placeholder="Nome">
            <div style="display:flex; gap:10px;"><input type="number" id="customCal" class="form-input" placeholder="Kcal"><input type="number" id="customP" class="form-input" placeholder="Prot"></div>
            <div style="display:flex; gap:10px;"><input type="number" id="customC" class="form-input" placeholder="Carb"><input type="number" id="customF" class="form-input" placeholder="Gord"></div>
        </div>
        <input type="number" id="foodQty" class="form-input" placeholder="Qtd (g ou unid)">
        <button class="btn-primary" onclick="app.addFood()">Adicionar</button>
        <button class="btn-outline" onclick="app.closeModals()">Cancelar</button>
    </div></div>

    <div id="measurementsModal" class="modal-overlay"><div class="modal-content">
        <h3 style="color:white; margin-bottom:20px;">Minhas Medidas (cm)</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; overflow-y:auto; margin-bottom:10px;">
            <div><label style="font-size:0.7rem; color:#888;">BRA√áO DIR</label><input type="number" id="mArmR" class="form-input" style="padding:10px;"></div>
            <div><label style="font-size:0.7rem; color:#888;">BRA√áO ESQ</label><input type="number" id="mArmL" class="form-input" style="padding:10px;"></div>
            <div><label style="font-size:0.7rem; color:#888;">PEITORAL</label><input type="number" id="mChest" class="form-input" style="padding:10px;"></div>
            <div><label style="font-size:0.7rem; color:#888;">CINTURA</label><input type="number" id="mWaist" class="form-input" style="padding:10px;"></div>
            <div><label style="font-size:0.7rem; color:#888;">COXA DIR</label><input type="number" id="mLegR" class="form-input" style="padding:10px;"></div>
            <div><label style="font-size:0.7rem; color:#888;">COXA ESQ</label><input type="number" id="mLegL" class="form-input" style="padding:10px;"></div>
            <div><label style="font-size:0.7rem; color:#888;">PANTURRILHA</label><input type="number" id="mCalf" class="form-input" style="padding:10px;"></div>
        </div>
        <button class="btn-primary" onclick="app.saveMeasurements()">Salvar Medidas</button>
        <button class="btn-outline" onclick="app.closeModals()">Fechar</button>
    </div></div>

    <script>
        const exDB = {
            "PEITO": [{n:"Supino reto (barra)",t:"GYM"},{n:"Supino reto (halteres)",t:"GYM"},{n:"Supino inclinado (barra)",t:"GYM"},{n:"Supino inclinado (halteres)",t:"GYM"},{n:"Supino declinado",t:"GYM"},{n:"Chest Press",t:"GYM"},{n:"Peck Deck",t:"GYM"},{n:"Crossover (alto)",t:"GYM"},{n:"Crossover (m√©dio)",t:"GYM"},{n:"Crossover (baixo)",t:"GYM"},{n:"Pull-over (halter)",t:"GYM"},{n:"Pull-over na m√°quina",t:"GYM"},{n:"Smith machine (supino)",t:"GYM"},{n:"Flex√£o tradicional",t:"CAL"},{n:"Flex√£o aberta",t:"CAL"},{n:"Flex√£o fechada",t:"CAL"},{n:"Flex√£o inclinada",t:"CAL"},{n:"Flex√£o declinada",t:"CAL"},{n:"Flex√£o explosiva",t:"CAL"},{n:"Flex√£o com palmas",t:"CAL"},{n:"Flex√£o arqueiro",t:"CAL"},{n:"Flex√£o unilateral",t:"CAL"},{n:"Dips (paralelas)",t:"CAL"},{n:"Flex√£o pseudo-planche",t:"CAL"},{n:"Planche (progress√µes)",t:"CAL"}],
            "COSTAS": [{n:"Barra fixa (livre/assistida)",t:"GYM"},{n:"Puxada frontal aberta",t:"GYM"},{n:"Puxada frontal fechada",t:"GYM"},{n:"Puxada neutra",t:"GYM"},{n:"Remada baixa",t:"GYM"},{n:"Remada alta",t:"GYM"},{n:"Remada curvada (barra)",t:"GYM"},{n:"Remada curvada (halter)",t:"GYM"},{n:"Remada unilateral",t:"GYM"},{n:"Remada cavalinho (T-bar)",t:"GYM"},{n:"Pulldown no cabo",t:"GYM"},{n:"Pullover no cabo",t:"GYM"},{n:"Encolhimento",t:"GYM"},{n:"M√°quina dorsal articulada",t:"GYM"},{n:"Smith machine (remada)",t:"GYM"},{n:"Barra fixa pronada",t:"CAL"},{n:"Barra fixa supinada",t:"CAL"},{n:"Barra fixa neutra",t:"CAL"},{n:"Barra fixa aberta",t:"CAL"},{n:"Barra fixa fechada",t:"CAL"},{n:"Barra fixa arqueiro",t:"CAL"},{n:"Barra fixa unilateral",t:"CAL"},{n:"Remada australiana",t:"CAL"},{n:"Remada australiana elevada",t:"CAL"},{n:"Eleva√ß√£o escapular",t:"CAL"},{n:"Front lever",t:"CAL"},{n:"Back lever",t:"CAL"}],
            "OMBROS": [{n:"Desenvolvimento barra",t:"GYM"},{n:"Desenvolvimento halteres",t:"GYM"},{n:"Desenvolvimento m√°quina",t:"GYM"},{n:"Eleva√ß√£o lateral",t:"GYM"},{n:"Eleva√ß√£o frontal",t:"GYM"},{n:"Eleva√ß√£o lateral cabo",t:"GYM"},{n:"Eleva√ß√£o posterior",t:"GYM"},{n:"Crucifixo invertido",t:"GYM"},{n:"Arnold press",t:"GYM"},{n:"Smith (desenvolvimento)",t:"GYM"},{n:"Flex√£o em pike",t:"CAL"},{n:"Pike elevado",t:"CAL"},{n:"Parada de m√£os",t:"CAL"},{n:"Flex√£o parada de m√£os",t:"CAL"},{n:"Planche lean",t:"CAL"},{n:"Planche",t:"CAL"},{n:"Flex√£o escapular",t:"CAL"}],
            "B√çCEPS": [{n:"Rosca direta (barra)",t:"GYM"},{n:"Rosca alternada",t:"GYM"},{n:"Rosca martelo",t:"GYM"},{n:"Rosca concentrada",t:"GYM"},{n:"Rosca Scott",t:"GYM"},{n:"Rosca no cabo",t:"GYM"},{n:"Rosca 21",t:"GYM"},{n:"Rosca banco inclinado",t:"GYM"},{n:"M√°quina de b√≠ceps",t:"GYM"},{n:"Barra fixa supinada",t:"CAL"},{n:"Chin-up fechado",t:"CAL"},{n:"Isometria na barra",t:"CAL"},{n:"Negativa na barra",t:"CAL"},{n:"Chin-up unilateral",t:"CAL"}],
            "TR√çCEPS": [{n:"Tr√≠ceps pulley",t:"GYM"},{n:"Tr√≠ceps corda",t:"GYM"},{n:"Tr√≠ceps testa",t:"GYM"},{n:"Tr√≠ceps franc√™s",t:"GYM"},{n:"Tr√≠ceps banco",t:"GYM"},{n:"Tr√≠ceps cabo unilateral",t:"GYM"},{n:"M√°quina de tr√≠ceps",t:"GYM"},{n:"Supino fechado",t:"GYM"},{n:"Flex√£o diamante",t:"CAL"},{n:"Dips",t:"CAL"},{n:"Bench dips",t:"CAL"},{n:"Korean dips",t:"CAL"},{n:"Pseudo-planche push-up",t:"CAL"}],
            "QUADRICEPS": [{n:"Agachamento livre",t:"GYM"},{n:"Agachamento frontal",t:"GYM"},{n:"Agachamento Smith",t:"GYM"},{n:"Leg press 45¬∞",t:"GYM"},{n:"Leg press horizontal",t:"GYM"},{n:"Hack machine",t:"GYM"},{n:"Cadeira extensora",t:"GYM"},{n:"Afundo com barra",t:"GYM"},{n:"Afundo com halteres",t:"GYM"},{n:"Passada no Smith",t:"GYM"},{n:"Agachamento livre",t:"CAL"},{n:"Agachamento profundo",t:"CAL"},{n:"Agachamento pistol",t:"CAL"},{n:"Pistol assistido",t:"CAL"},{n:"Agachamento shrimp",t:"CAL"},{n:"Jump squat",t:"CAL"},{n:"Wall sit",t:"CAL"},{n:"Step-up",t:"CAL"}],
            "POSTERIOR": [{n:"Mesa flexora",t:"GYM"},{n:"Flexora em p√©",t:"GYM"},{n:"Stiff",t:"GYM"},{n:"Levantamento terra",t:"GYM"},{n:"Terra romeno",t:"GYM"},{n:"Good morning",t:"GYM"},{n:"Glute ham raise",t:"GYM"},{n:"Nordic curl",t:"CAL"},{n:"Ponte de gl√∫teos",t:"CAL"},{n:"Ponte unilateral",t:"CAL"},{n:"Hamstring walkout",t:"CAL"},{n:"Prancha reversa",t:"CAL"}],
            "GLUTEOS": [{n:"Hip thrust",t:"GYM"},{n:"Hip thrust Smith",t:"GYM"},{n:"Glute bridge",t:"GYM"},{n:"Abdu√ß√£o m√°quina",t:"GYM"},{n:"Cadeira abdutora",t:"GYM"},{n:"Kickback no cabo",t:"GYM"},{n:"Step-up com peso",t:"GYM"},{n:"Ponte de gl√∫teos",t:"CAL"},{n:"Elev quadril unilateral",t:"CAL"},{n:"Afundo",t:"CAL"},{n:"Afundo b√∫lgaro",t:"CAL"},{n:"Coice de gl√∫teo",t:"CAL"},{n:"Abdu√ß√£o quadril",t:"CAL"}],
            "PANTURRILHA": [{n:"Panturrilha em p√©",t:"GYM"},{n:"Panturrilha sentada",t:"GYM"},{n:"Panturrilha no leg press",t:"GYM"},{n:"Panturrilha unilateral",t:"GYM"},{n:"Eleva√ß√£o bilateral",t:"CAL"},{n:"Eleva√ß√£o unilateral",t:"CAL"},{n:"Isometria",t:"CAL"},{n:"Saltos",t:"CAL"}],
            "CORE": [{n:"Abdominal m√°quina",t:"GYM"},{n:"Abdominal no cabo",t:"GYM"},{n:"Crunch no banco",t:"GYM"},{n:"Crunch declinado",t:"GYM"},{n:"Prancha com carga",t:"GYM"},{n:"Lombar banco romano",t:"GYM"},{n:"Rota√ß√£o tronco cabo",t:"GYM"},{n:"Crunch",t:"CAL"},{n:"Sit-up",t:"CAL"},{n:"Hollow body",t:"CAL"},{n:"Hollow rocks",t:"CAL"},{n:"Elev pernas solo",t:"CAL"},{n:"Elev pernas barra",t:"CAL"},{n:"Toes to bar",t:"CAL"},{n:"L-sit",t:"CAL"},{n:"V-sit",t:"CAL"},{n:"Dragon flag",t:"CAL"},{n:"Prancha",t:"CAL"},{n:"Prancha lateral",t:"CAL"},{n:"Bird dog",t:"CAL"},{n:"Superman",t:"CAL"},{n:"Windshield wipers",t:"CAL"}],
            "ANTEBRACO": [{n:"Rosca inversa",t:"GYM"},{n:"Wrist curl",t:"GYM"},{n:"Wrist curl reverso",t:"GYM"},{n:"Farmer walk",t:"GYM"},{n:"Dead hang",t:"CAL"},{n:"Active hang",t:"CAL"},{n:"Hang com toalha",t:"CAL"},{n:"Flex√£o nos punhos",t:"CAL"},{n:"Flex√£o nos dedos",t:"CAL"}],
            "FUNCIONAL": [{n:"Kettlebell swing",t:"GYM"},{n:"Battle rope",t:"GYM"},{n:"Sled push / pull",t:"GYM"},{n:"Medicine ball slam",t:"GYM"},{n:"Farmer carry",t:"GYM"},{n:"Burpee",t:"CAL"},{n:"Polichinelo",t:"CAL"},{n:"Escalador",t:"CAL"},{n:"Bear crawl",t:"CAL"},{n:"Crab walk",t:"CAL"},{n:"Sprint",t:"CAL"},{n:"Corda",t:"CAL"}],
            "SKILLS": [{n:"Muscle-up",t:"CAL"},{n:"Front lever",t:"CAL"},{n:"Back lever",t:"CAL"},{n:"Bandeira humana",t:"CAL"},{n:"Planche",t:"CAL"},{n:"Caminhada parada m√£os",t:"CAL"},{n:"Flex√£o 90¬∞",t:"CAL"},{n:"Hefesto",t:"CAL"}]
        };

        const foodDB = [
            {id:'custom',n:'+ Personalizado',u:'g',cal:0,p:0,c:0,f:0},
            {id:1,n:"Ovo Cozido",cal:78,p:6,c:0.6,f:5}, {id:2,n:"Frango (100g)",cal:165,p:31,c:0,f:3.6},
            {id:3,n:"Arroz (100g)",cal:130,p:2.7,c:28,f:0.3}, {id:4,n:"Feij√£o (100g)",cal:76,p:4.8,c:13.6,f:0.5},
            {id:5,n:"Banana",cal:98,p:1.3,c:26,f:0.4}, {id:6,n:"P√£o Franc√™s",cal:135,p:4,c:25,f:0},
            {id:7,n:"Whey Protein",cal:120,p:24,c:3,f:1}, {id:8,n:"Aveia (100g)",cal:389,p:16,c:66,f:6},
            {id:9,n:"Batata Doce (100g)",cal:86,p:1.6,c:20,f:0.1}, {id:10,n:"Leite (200ml)",cal:120,p:6,c:10,f:6}
        ];

        const app = {
            data: { user: null, xp: 0, workouts: [], meals: [], bio: {h:0,w:0}, goals: {cal:2000,p:150,c:200,f:60}, log: {}, water: 0, history: {}, measures: {} },
            timer: null, timeLeft: 0,

            init() {
                const s = localStorage.getItem('titanV39');
                if (s) { try { this.data = JSON.parse(s); } catch(e) {} }
                if(!this.data.bio) this.data.bio = {h:0,w:0};
                if(!this.data.log) this.data.log = {};
                if(!this.data.water) this.data.water = 0;
                if(!this.data.history) this.data.history = {};
                if(!this.data.measures) this.data.measures = {};

                const t = this.getTodayStr();
                if(this.data.lastLogin !== t) { this.data.water=0; this.data.lastLogin=t; this.save(); }
                if (this.data.user) this.showApp();
            },

            save() { localStorage.setItem('titanV39', JSON.stringify(this.data)); },

            login() {
                const u = document.getElementById('loginUser').value;
                if (!u) return alert("Preencha todos os campos!");
                this.data.user = u;
                this.data.bio.w = parseFloat(document.getElementById('loginWeight').value)||0;
                this.data.bio.h = parseFloat(document.getElementById('loginHeight').value)||0;
                this.save(); this.showApp(); this.saveProfile();
            },

            showApp() {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                document.getElementById('headerName').innerText = this.data.user;
                document.getElementById('userWeight').value = this.data.bio.w;
                document.getElementById('userHeight').value = this.data.bio.h;
                this.render(); this.renderHome();
            },

            logout() { if(confirm("Sair?")){this.data.user = null; this.save(); location.reload();} },
            resetAll() { if(confirm("Resetar?")){localStorage.removeItem('titanV39'); location.reload();} },

            nav(tab, btn) {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                ['home','treino','nutri','config'].forEach(t => document.getElementById('tab-'+t).classList.add('hidden'));
                document.getElementById('tab-'+tab).classList.remove('hidden');
                if(tab === 'home') this.renderHome();
                if(tab === 'treino') this.render();
                if(tab === 'nutri') this.render();
            },

            // --- HOME ---
            getTodayStr() { return new Date().toISOString().split('T')[0]; },

            logAction(type) {
                const today = this.getTodayStr();
                if(!this.data.log[today]) this.data.log[today] = {cal:0, workouts:0};
                if(type === 'workout') this.data.log[today].workouts += 1;
                this.save();
                this.renderHome();
            },

            renderHome() {
                const today = this.getTodayStr();
                const todayData = this.data.log[today] || {cal:0, workouts:0};

                let currentCal = 0;
                this.data.meals.forEach(m => currentCal += m.cal);
                document.getElementById('homeKcal').innerText = Math.round(currentCal);
                document.getElementById('homeWorkouts').innerText = todayData.workouts;

                const grid = document.getElementById('streakGrid');
                grid.innerHTML = "";
                ['D','S','T','Q','Q','S','S'].forEach((d, i) => {
                    let activeClass = "";
                    let isToday = (i === new Date().getDay()) ? "today" : "";
                    if (i === new Date().getDay() && todayData.workouts > 0) activeClass = "active";
                    grid.innerHTML += `<div class="streak-day"><div class="day-circle ${activeClass} ${isToday}">${d}</div></div>`;
                });

                const wg = document.getElementById('waterGrid'); wg.innerHTML = "";
                // 14 Copos
                for(let i=0; i<14; i++) {
                    const f = i < this.data.water ? "full" : "";
                    wg.innerHTML += `<div class="water-item ${f}" onclick="app.toggleWater(${i})">üíß</div>`;
                }
                document.getElementById('waterText').innerText = this.data.water + "/14 copos";
            },

            toggleWater(i) {
                if(i < this.data.water) this.data.water = i; else this.data.water = i+1;
                this.data.xp += 5; this.save(); this.renderHome();
            },

            // --- CALCS & TOOLS ---
            calcRM() {
                const w = parseFloat(document.getElementById('rmWeight').value);
                const r = parseFloat(document.getElementById('rmReps').value);
                if(w && r) document.getElementById('rmResult').innerText = Math.round(w * (1 + r/30)) + " KG";
            },
            calcIMC() {
                const w = parseFloat(document.getElementById('imcWeight').value);
                const h = parseFloat(document.getElementById('imcHeight').value);
                if(!w || !h) return alert("Preencha peso e altura");
                const imc = w / ((h/100)**2);
                const val = document.getElementById('imcValue');
                const txt = document.getElementById('imcText');
                val.innerText = imc.toFixed(1);
                if(imc < 18.5) { txt.innerText = "Abaixo do Peso"; txt.style.color = "#eab308"; }
                else if(imc < 24.9) { txt.innerText = "Peso Normal"; txt.style.color = "#22c55e"; }
                else if(imc < 29.9) { txt.innerText = "Sobrepeso"; txt.style.color = "#eab308"; }
                else { txt.innerText = "Obesidade"; txt.style.color = "#ef4444"; }
            },

            saveMeasurements() {
                this.data.measures = {
                    armR: document.getElementById('mArmR').value,
                    armL: document.getElementById('mArmL').value,
                    chest: document.getElementById('mChest').value,
                    waist: document.getElementById('mWaist').value,
                    legR: document.getElementById('mLegR').value,
                    legL: document.getElementById('mLegL').value,
                    calf: document.getElementById('mCalf').value
                };
                this.save(); alert("Medidas Salvas!"); this.closeModals();
            },

            exportData() {
                const str = JSON.stringify(this.data);
                if(navigator.clipboard) {
                    navigator.clipboard.writeText(str).then(() => alert("Dados copiados! Salve em um local seguro."));
                } else {
                    prompt("Copie este c√≥digo manualmente:", str);
                }
            },

            importData() {
                const str = prompt("Cole o c√≥digo dos seus dados aqui:");
                if(str) {
                    try {
                        JSON.parse(str);
                        localStorage.setItem('titanV39', str);
                        alert("Dados recuperados com sucesso!");
                        location.reload();
                    } catch(e) {
                        alert("C√≥digo inv√°lido!");
                    }
                }
            },

            // --- TIMER ---
            startTimer() {
                clearInterval(this.timer); this.timeLeft = 60;
                document.getElementById('smartTimer').classList.add('active'); this.updateTimer();
                this.timer = setInterval(() => {
                    this.timeLeft--; this.updateTimer();
                    if(this.timeLeft <= 0) { this.stopTimer(); if(navigator.vibrate) navigator.vibrate([200, 100, 200]); alert("Tempo esgotado!"); }
                }, 1000);
            },
            addTime() { this.timeLeft += 30; this.updateTimer(); },
            stopTimer() { clearInterval(this.timer); document.getElementById('smartTimer').classList.remove('active'); },
            updateTimer() { document.getElementById('timerDisplay').innerText = `${Math.floor(this.timeLeft/60)}:${(this.timeLeft%60).toString().padStart(2,'0')}`; },

            // --- WORKOUTS ---
            renderExList() {
                const g = document.getElementById('muscleGroup').value;
                const area = document.getElementById('exListArea'); area.innerHTML = "";
                if(exDB[g]) {
                    exDB[g].forEach(e => {
                        const name = typeof e === 'object' ? e.n : e;
                        const tagClass = (typeof e === 'object' && e.t === 'CAL') ? 'tag-cal' : 'tag-gym';
                        const tagName = (typeof e === 'object' && e.t === 'CAL') ? 'CALISTENIA' : 'MUSCULA√á√ÉO';

                        area.innerHTML += `
                        <div class="ex-select-item" style="display:flex; align-items:center; padding:12px 0; border-bottom:1px solid #333;">
                            <input type="checkbox" value="${name}" class="ex-check" style="margin-right:12px; width:18px; height:18px;">
                            <span class="ex-name" style="flex:1; color:white; font-size:0.9rem;">${name}</span>
                            <span class="ex-tag ${tagClass}" style="font-size:0.6rem; padding:3px 8px; border-radius:4px; font-weight:700; background:var(--${tagClass}-bg); color:var(--${tagClass}-text);">${tagName}</span>
                        </div>`;
                    });
                }
            },

            saveWorkout() {
                const n = document.getElementById('workoutName').value || "Treino";
                const cbs = document.querySelectorAll('.ex-check:checked');
                if(cbs.length === 0) return alert("Selecione exerc√≠cios!");
                const exs = Array.from(cbs).map(c => ({n: c.value, done: false, kg:0, reps:0}));
                this.data.workouts.push({id: Date.now(), name: n, exs: exs});
                this.save(); this.closeModals(); this.render();
            },

            toggleEx(wid, idx) {
                const w = this.data.workouts.find(x => x.id === wid);
                w.exs[idx].done = !w.exs[idx].done;
                if(w.exs[idx].done) {
                    this.data.xp += 10;
                    this.startTimer();
                    this.logAction('workout');
                    const ex = w.exs[idx];
                    if(ex.kg > 0) this.data.history[ex.n] = { kg: ex.kg, reps: ex.reps };
                }
                this.save(); this.render();
            },

            updateEx(wid, idx, field, val) {
                const w = this.data.workouts.find(x => x.id === wid);
                w.exs[idx][field] = val;
                this.save();
            },

            deleteWorkout(id) {
                if(confirm("Apagar ficha?")) {
                    this.data.workouts = this.data.workouts.filter(w => w.id !== id);
                    this.save(); this.render();
                }
            },

            // --- NUTRI ---
            checkCustomFood() {
                const v = document.getElementById('foodSelect').value;
                if(v === 'custom') { document.getElementById('customFoodArea').classList.remove('hidden'); document.getElementById('foodQty').classList.add('hidden'); }
                else { document.getElementById('customFoodArea').classList.add('hidden'); document.getElementById('foodQty').classList.remove('hidden'); }
            },

            addFood() {
                const id = document.getElementById('foodSelect').value;
                let m = {};
                if(id === 'custom') {
                    const n = document.getElementById('customName').value;
                    const cal = parseFloat(document.getElementById('customCal').value);
                    if(!n || isNaN(cal)) return alert("Preencha Nome e Calorias!");
                    m = { n: n, cal: cal, p: parseFloat(document.getElementById('customP').value)||0, c: parseFloat(document.getElementById('customC').value)||0, f: parseFloat(document.getElementById('customF').value)||0 };
                } else {
                    const qty = parseFloat(document.getElementById('foodQty').value); if(!qty) return alert("Digite a quantidade");
                    const f = foodDB.find(x=>x.id==id);
                    let factor = qty;
                    if(f.n.includes('100g') || f.n.includes('ml')) factor = qty/100;
                    m = { n: f.n, cal: f.cal*factor, p: (f.p||0)*factor, c: (f.c||0)*factor, f: (f.f||0)*factor };
                }
                this.data.meals.push(m);
                this.save(); this.closeModals(); this.render();
            },

            delMeal(i) { this.data.meals.splice(i,1); this.save(); this.render(); },

            resetDiet() {
                if(confirm("Zerar alimenta√ß√£o de hoje?")) {
                    this.data.meals = [];
                    this.save(); this.render(); this.renderHome();
                }
            },

            saveProfile() {
                const w = parseFloat(document.getElementById('userWeight').value);
                const h = parseFloat(document.getElementById('userHeight').value);
                const act = parseFloat(document.getElementById('userAct').value) || 1.375;
                if(!w || !h) return alert("Preencha Peso e Altura");

                this.data.bio.w = w; this.data.bio.h = h;
                const tdee = Math.round(((10*w) + (6.25*h) - (5*25) + 5) * act);
                this.data.goals = { cal: tdee, p: Math.round(w*2), f: Math.round(w*0.8), c: Math.round((tdee - (w*2*4) - (w*0.8*9)) / 4) };

                this.save(); alert("Salvo!"); this.render();
            },

            // --- UTILS ---
            toggleCard(head) { head.parentElement.classList.toggle('open'); },
            openModal(id) {
                document.getElementById(id).classList.add('active');
                if(id==='foodModal'){const s=document.getElementById('foodSelect'); s.innerHTML=""; foodDB.forEach(f=>s.innerHTML+=`<option value="${f.id}">${f.n}</option>`); this.checkCustomFood();}
                if(id==='imcModal'){
                    document.getElementById('imcWeight').value = this.data.bio.w;
                    document.getElementById('imcHeight').value = this.data.bio.h;
                    if(this.data.bio.w && this.data.bio.h) this.calcIMC();
                }
                if(id==='measurementsModal') {
                    document.getElementById('mArmR').value = this.data.measures.armR || '';
                    document.getElementById('mArmL').value = this.data.measures.armL || '';
                    document.getElementById('mChest').value = this.data.measures.chest || '';
                    document.getElementById('mWaist').value = this.data.measures.waist || '';
                    document.getElementById('mLegR').value = this.data.measures.legR || '';
                    document.getElementById('mLegL').value = this.data.measures.legL || '';
                    document.getElementById('mCalf').value = this.data.measures.calf || '';
                }
            },
            closeModals() { document.querySelectorAll('.modal-overlay').forEach(m=>m.classList.remove('active')); },

            render() {
                document.getElementById('headerXP').innerText = this.data.xp + " XP";

                // WORKOUTS
                const wc = document.getElementById('workoutContainer'); wc.innerHTML="";
                if(this.data.workouts.length) {
                    document.getElementById('emptyMsg').classList.add('hidden');
                    this.data.workouts.forEach(w => {
                        let h="";
                        w.exs.forEach((e,i)=> {
                            let last = this.data.history[e.n] ? `√öltimo: ${this.data.history[e.n].kg}kg` : '';
                            h+=`
                            <div class="ex-item ${e.done?'done':''}">
                                <div class="ex-meta">
                                    <div class="ex-name" style="color:white; font-size:0.9rem;">${e.n}</div>
                                    <div style="font-size:0.65rem; color:#60a5fa; margin-top:2px;">${last}</div>
                                </div>
                                <input type="number" class="ex-input-small" placeholder="kg" value="${e.kg||''}" onchange="app.updateEx(${w.id},${i},'kg',this.value)">
                                <input type="number" class="ex-input-small" placeholder="reps" value="${e.reps||''}" onchange="app.updateEx(${w.id},${i},'reps',this.value)">
                                <div class="check-btn" onclick="app.toggleEx(${w.id},${i})">‚úì</div>
                            </div>`;
                        });
                        wc.innerHTML+=`<div class="card" style="margin-bottom:15px;"><div class="card-head" onclick="app.toggleCard(this)"><div><div class="card-title">${w.name}</div><div class="card-sub">${w.exs.length} exerc√≠cios</div></div><span class="arrow">‚ñº</span></div><div class="card-body">${h}<button onclick="app.deleteWorkout(${w.id})" style="color:red;background:none;border:none;margin-top:10px;font-size:0.8rem;cursor:pointer;">Excluir Ficha</button></div></div>`;
                    });
                } else document.getElementById('emptyMsg').classList.remove('hidden');

                // NUTRI
                const ml = document.getElementById('mealList'); ml.innerHTML=""; let t = {cal:0, p:0, c:0, f:0};
                this.data.meals.forEach((m,i)=> {
                    t.cal+=m.cal; t.p+=m.p||0; t.c+=m.c||0; t.f+=m.f||0;
                    ml.innerHTML+=`<div style="display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #333;"><div><div style="font-weight:600;color:white;">${m.n}</div><div style="font-size:0.8rem;color:#888;">${Math.round(m.cal)} kcal</div></div><div onclick="app.delMeal(${i})" style="color:red;cursor:pointer;">‚úï</div></div>`
                });

                document.getElementById('totalCal').innerText = Math.round(t.cal);
                document.getElementById('targetCal').innerText = this.data.goals.cal;

                document.getElementById('txtP').innerText = Math.round(t.p)+"/"+this.data.goals.p+"g"; document.getElementById('barP').style.width = Math.min((t.p/this.data.goals.p)*100, 100) + "%";
                document.getElementById('txtC').innerText = Math.round(t.c)+"/"+this.data.goals.c+"g"; document.getElementById('barC').style.width = Math.min((t.c/this.data.goals.c)*100, 100) + "%";
                document.getElementById('txtF').innerText = Math.round(t.f)+"/"+this.data.goals.f+"g"; document.getElementById('barF').style.width = Math.min((t.f/this.data.goals.f)*100, 100) + "%";
            }
        };

        app.init();
    </script>
</body>
</html>